swagger: "2.0"
info:
  version: "1.0.0"
  title: Backend
host: localhost:4000
basePath: /api
schemes:
  - http
  - https
securityDefinitions:
  Bearer:
    type: apiKey
    name: Authorization
    in: header
    description: |
     For accessing the API a valid JWT token must be passed in all the queries in
     the 'Authorization' header.
  
  
     A valid JWT token is generated by the API and retourned as answer of a call
     to the route /login giving a valid user & password.
  
  
     The following syntax must be used in the 'Authorization' header :
  
         Bearer xxxxxx.yyyyyyy.zzzzzz

consumes:
  - application/json
produces:
  - application/json
paths:
  /users:
    x-swagger-router-controller: users.controller
    post:
      tags:
        - Users
      operationId: usersControllerPost
      description: "Create User"
      parameters:
        - name: authentication
          in: body
          required: true
          schema:
            $ref: "#/definitions/User"
      responses:
        "201":
          description: "Created"
        "403":
          description: "Access Denied"

  /services:
    x-swagger-router-controller: services.controller
    post:
      tags:
        - Services
      operationId: servicesControllerPost
      summary: "Create Service"
      description: "Create a new Service"
      parameters:
        - name: service
          in: body
          required: true
          schema:
            $ref: '#/definitions/Service'
      responses:
        "200":
          description: "Success"
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'
    get:
      tags:
        - Services
      operationId: servicesControllerGet
      summary: "Get Services"
      description: "Get all the Services"
      responses:
        "200":
          description: "Success"
          schema:
            $ref: '#/definitions/Service'
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

  /services/{idService}:
    x-swagger-router-controller: services.controller
    parameters:
      - name: idService
        in: path
        description: "ID of the Service"
        required: true
        type: string
    get:
      tags:
        - Services
      operationId: servicesControllerGetId
      summary: "Get Service"
      description: "Get only one Service"
      responses:
        "200":
          description: "Success"
          schema:
            $ref: '#/definitions/Service'
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

    put:
      tags:
        - Services
      operationId: servicesControllerPutId
      summary: "Update a Service"
      description: "Update only one Service"
      responses:
        200:
          description: "Success"
          
    delete:
      tags:
        - Services
      operationId: servicesControllerDeleteId
      summary: "Delete a Service"
      description: "Delete only one Service"
      responses:
        200:
          description: "Success"
 
  /polls:
    x-swagger-router-controller: polls.controller
    post:
      tags:
        - Polls
      operationId: pollsControllerPost
      summary: "Create Poll"
      description: "Create a new Poll"
      parameters:
        - name: poll
          in: body
          required: true
          schema:
            $ref: '#/definitions/Poll'
      responses:
        "200":
          description: "Success"
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'
    get:
      tags:
        - Polls
      operationId: pollsControllerGet
      summary: "Get polls"
      description: "Get all the polls"
      responses:
        "200":
          description: "Success"
          schema:
            $ref: '#/definitions/Poll'
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

  /polls/{idPoll}:
    x-swagger-router-controller: polls.controller
    parameters:
      - name: idPoll
        in: path
        description: "ID of the poll"
        required: true
        type: string
    get:
      tags:
        - Polls
      operationId: pollsControllerGetId
      summary: "Get poll"
      description: "Get only one polls"
      responses:
        "200":
          description: "Success"
          schema:
            $ref: '#/definitions/Poll'
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

    put:
      tags:
        - Polls
      summary: "Update a poll"
      operationId: pollsControllerPutId
      description: "Update only one poll"
      responses:
        200:
          description: "Success"
          
    delete:
      tags:
        - Polls
      summary: "Delete a poll"
      operationId: pollsControllerDeleteId
      description: "Delete only one poll"
      responses:
        200:
          description: "Success"
 
  /people:
    x-swagger-router-controller: peoplecontroller
    post:
      tags:
        - People
      operationId: peopleControllerPost
      summary: "Create Person"
      description: "Create a new Person"
      parameters:
        - name: person
          in: body
          required: true
          schema:
            $ref: '#/definitions/Person'
      responses:
        200:
          description: "Success"
        403:
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'
    get:
      tags:
        - People
      operationId: peopleControllerGet
      summary: "Get People"
      description: "Get all the People"
      responses:
        200:
          description: "Success"
          schema:
            $ref: '#/definitions/Person'
        403:
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

  /people/{idPerson}:
    x-swagger-router-controller: people.controller
    parameters:
      - name: idPerson
        in: path
        description: "ID of the Person"
        required: true
        type: string
    get:
      tags:
        - People
      operationId: peopleControllerGetId
      summary: "Get person"
      description: "Get only one Person"
      responses:
        200:
          description: "Success"
          schema:
            $ref: '#/definitions/Person'
        403:
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

    put:
      tags:
        - People
      operationId: peopleControllerPutId
      summary: "Update a person"
      description: "Update only one person"
      responses:
        200:
          description: "Success"
        403:
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'
          
    delete:
      tags:
        - People
      operationId: peopleControllerDeleteId
      summary: "Delete a person"
      description: "Delete only one person"
      responses:
        200:
          description: "Success"
        403:
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'
 
  /people/{idPerson}/patients:
    x-swagger-router-controller: patients.controller
    parameters:
      - name: idPerson
        in: path
        description: "ID of the Person"
        required: true
        type: string
    post:
      tags:
        - Patients
      operationId: patientsControllerPost
      summary: "Create Patients"
      description: "Create a new Patients"
      parameters:
        - name: poll
          in: body
          required: true
          schema:
            $ref: '#/definitions/Patient'
      responses:
        "200":
          description: "Success"
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'
    get:
      tags:
        - Patients
      operationId: patientsControllerGet
      summary: "Get Patients"
      description: "Get all the Patients"
      responses:
        "200":
          description: "Success"
          schema:
            $ref: '#/definitions/Patient'
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

  /people/{idPerson}/patients/{idpatient}:
    x-swagger-router-controller: patients.controller
    parameters:
      - name: idpatient
        in: path
        description: "ID of the patient"
        required: true
        type: string
      - name: idPerson
        in: path
        description: "ID of the Person"
        required: true
        type: string
    get:
      tags:
        - Patients
      operationId: patientsControllerGetId
      summary: "Get patient"
      description: "Get only one patients"
      responses:
        "200":
          description: "Success"
          schema:
            $ref: '#/definitions/Patient'
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'
    put:
      tags:
        - Patients
      operationId: patientsControllerPutId
      summary: "Update a patient"
      description: "Update only one patient"
      responses:
        200:
          description: "Success"
    delete:
      tags:
        - Patients
      summary: "Delete a patient"
      operationId: patientsControllerDeleteId
      description: "Delete only one patient"
      responses:
        200:
          description: "Success"

  /procedure:
    x-swagger-router-controller: procedurecontroller
    post:
      tags:
        - Procedure
      operationId: procedureControllerPost
      summary: "Create Procedure"
      description: "Create a new Procedure"
      parameters:
        - name: Procedure
          in: body
          required: true
          schema:
            $ref: '#/definitions/Procedure'
      responses:
        200:
          description: "Success"
        403:
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'
    get:
      tags:
        - Procedure
      operationId: procedureControllerGet
      summary: "Get Procedure"
      description: "Get all the Procedure"
      responses:
        200:
          description: "Success"
          schema:
            $ref: '#/definitions/Procedure'
        403:
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

  /procedure/{idProcedure}:
    x-swagger-router-controller: procedure.controller
    parameters:
      - name: idProcedure
        in: path
        description: "ID of the Person"
        required: true
        type: string
    get:
      tags:
        - Procedure
      operationId: procedureControllerGetId
      summary: "Get procedure"
      description: "Get only one Person"
      responses:
        200:
          description: "Success"
          schema:
            $ref: '#/definitions/Person'
        403:
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

    put:
      tags:
        - Procedure
      operationId: procedureControllerPutId
      summary: "Update a procedure"
      description: "Update only one procedure"
      responses:
        200:
          description: "Success"
        403:
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'
          
    delete:
      tags:
        - Procedure
      operationId: procedureControllerDeleteId
      summary: "Delete a procedure"
      description: "Delete only one procedure"
      responses:
        200:
          description: "Success"
        403:
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

  /login:
    x-swagger-router-controller: users.controller
    post:
      tags:
        - Users
      operationId: loginPost
      description: "Login"
      parameters:
        - name: authentication
          in: body
          required: true
          schema:
            $ref: "#/definitions/Authentication"
      responses:
        "200":
          description: "Success"
          schema:
            $ref: "#/definitions/Login"
        "403":
          description: "Access Denied"
          schema:
            $ref: "#/definitions/Error"

  /institutions:
    x-swagger-router-controller: institutions.controller
    post:
      tags:
        - Institution
      operationId: institutionsControllerPost
      summary: "Create Institution"
      description: "Create a new Institution"
      parameters:
        - name: institution
          in: body
          required: true
          schema:
            $ref: '#/definitions/Institution'
      responses:
        "200":
          description: "Success"
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'
    get:
      tags:
        - Institution
      operationId: institutionsControllerGet
      summary: "Get Institution"
      description: "Get all the Institution"
      responses:
        "200":
          description: "Success"
          schema:
            $ref: '#/definitions/Institution'
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

  /institutions/{idInstitution}:
    x-swagger-router-controller: institutions.controller
    parameters:
      - name: idInstitution
        in: path
        description: "ID of the Institution"
        required: true
        type: string
    get:
      tags:
        - Institution
      operationId: institutionsControllerGetId
      summary: "Get Institution"
      description: "Get only one Institution"
      responses:
        "200":
          description: "Success"
          schema:
            $ref: '#/definitions/Institution'
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

    put:
      tags:
        - Institution
      operationId: institutionsControllerPutId
      summary: "Update a Institution"
      description: "Update only one Institution"
      responses:
        200:
          description: "Success"
          
    delete:
      tags:
        - Institution
      operationId: institutionsControllerDeleteId
      summary: "Delete a Institution"
      description: "Delete only one Institution"
      responses:
        200:
          description: "Success"

  /protected:
    x-swagger-router-controller: main-controller
    get:
      operationId: protectedGet
      description: "Protected endpoint, only accessible to 'admins' and 'users'"
      security:
        - Bearer: []
      x-security-scopes:
        - admin
        - user
      responses:
        "200":
          description: "Success"
          schema:
            $ref: "#/definitions/Resource"
        "403":
          description: "Access Denied"
          schema:
            $ref: "#/definitions/Error"

  /protected2:
    x-swagger-router-controller: main-controller
    get:
      operationId: protected2Get
      description: "Protected endpoint, only accessible to 'admins'"
      security:
        - Bearer: []
      x-security-scopes:
        - admin
      responses:
        "200":
          description: "Success"
          schema:
            $ref: "#/definitions/Resource"
        "403":
          description: "Access Denied"
          schema:
            $ref: "#/definitions/Error"
  /test:
    x-swagger-router-controller: test.controller
    get:
      tags:
        - Test
      description: "is a test endpoint"
      operationId: testsControllerGet
      responses:
        "200":
          description: "Success"
          schema:
            $ref: "#/definitions/Resource"
        "403":
          description: "Access Denied"
          schema:
            $ref: "#/definitions/Error"
    post:
      tags:
        - Test
      operationId: testsControllerPost
      summary: "Create Institution"
      description: "Create a new Institution"
      parameters:
        - name: institution
          in: body
          required: true
          schema:
            $ref: '#/definitions/Institution'
      responses:
        "200":
          description: "Success"
        "403":
          description: "Access Denied"
          schema:
            $ref: '#/definitions/Error'

definitions:
  Authentication:
    type: object
    properties:
      username:
        type: string
        example: "username"
      password:
        type: string
        example: "password"

  User:
    type: object
    properties:
      username:
        type: string
        example: "username"
      password:
        type: string
        example: "password"
      roles:
        type: array
        items:
          $ref: '#/definitions/Role'

  Role:
    type: object
    properties:
      name:
        type: string
        example: "resident"
      resources:
        type: array
        items:
          $ref: '#/definitions/Resource'
      specialPermission:
        type: string
        enum: ["Full Access", "No Access", "Null"]
        example: "Full Access"
      description:
        type: string
        example: "This is the role of a resident"
  
  Resource:
    type: object
    properties:
      'question':
        type: array
        items:
          $ref: '#/definitions/Permission'
      'answer':
        type: array
        items:
          $ref: '#/definitions/Permission'
      'answer type':
        type: array
        items:
          $ref: '#/definitions/Permission'
      'question group':
        type: array
        items:
          $ref: '#/definitions/Permission'
      'service':
        type: array
        items:
          $ref: '#/definitions/Permission'
      'institution':
        type: array
        items:
          $ref: '#/definitions/Permission'
      'poll':
        type: array
        items:
          $ref: '#/definitions/Permission'
      'user':
        type: array
        items:
          $ref: '#/definitions/Permission'
      'role':
        type: array
        items:
          $ref: '#/definitions/Permission'
      'procedure':
        type: array
        items:
          $ref: '#/definitions/Permission'
      'patient':
        type: array
        items:
          $ref: '#/definitions/Permission'
  
  Permission:
    type: object
    properties:
      create:
        type: boolean
        example: true
      delete:
        type: boolean
        example: false
      modify:
        type: boolean
        example: true
  
  Service:
    type: object
    properties:
      id:
        type: string
      serviceName:
        type: string
        example: "Traumatologia"
      serviceCode:
        type: string
        example: "35489"
      owner:
        type: string
        example: "Bartolome Allende"
  
  Institution:
    type: object
    properties:
      id:
        type: string
        description: ""
      institutionName:
        type: string
        description: ""
        example: "Sanatorio Allende"
      displayName:
        type: string
        description: ""
        example: "Sanatorio Allende Nueva Córdoba"
      country:
        type: string
        description: ""
        example: "Argentina"
      state:
        type: string
        description: ""
        example: "Cordoba"
      city:
        type: string
        description: ""
        example: "Cordoba"
      direction:
        type: string
        description: ""
        example: "Av. Hipólito Yrigoyen 384"
      description:
        type: string
        description: ""
        example: ""
      typeOfEstablishment:
        type: string
        description: ""
        example: ""
  
  Procedure:
    type: object
    properties:
      id:
        type: string
      typeOfProcedure:
        type: string
        example: "Cirugia"
      detailProcedure:
        type: string
        example: "AMIGDALECTOMIA"
      date:
        type: string
        example: "09/09/2019"
      institutionId:
        type: string
      serviceId:
        type: string
      patientId:
        type: string
      description:
        type: string
        
  Poll:
    type: object
    properties:
      id:
        type: string
      name:
        type: string
        example: "Womac Score"
      type:
        type: string
        example: "Score"
      detail:
        type: string
        example: "Pre Quirurgico"
      group:
        type: array
        items:
          $ref: '#/definitions/PollGroup'
  
  PollGroup:
    type: object
    properties:
      id:
        type: string
      name:
        type: string
      description:
      
        type: string
     
      subGroup:
        type: array
        items:
          $ref: '#/definitions/PollSubGroup'

  PollSubGroup:
    type: object
    properties:
      id:
        type: string
      name:
        type: string
      description:
        type: string
        example: "¿Qué grado de dolor tienes?"
      questions:
        type: array
        items:
          $ref: '#/definitions/Question'
      typeOfAnswer:
        $ref: '#/definitions/TypeOfAnswer'
      
  TypeOfAnswer:
    type: object
    properties:
      id:
        type: string
      name:
        type: string
      description:
        type: string
        example: "Ninguno, Leve, Moderado, Severo, Extremo"
      values:
        type: array
        items:
          $ref: '#/definitions/Values'

  Values:
    type: object
    properties:
      id:
        type: string
      value:
        type: string
        example: "MODERADO"
      score:
        type: integer
        example: "2"

  Question:
    type: object
    properties:
      id:
        type: string
      question:
        type: string
        example: "Subiendo y bajando escaleras"

  Person:
    type: object
    properties:
      id:
        type: string
      dni:
        type: string
        example: "37195387"
      birthdate:
        type: string
        example: "09/01/1993"
      name:
        type: string
        example: "Federico Martin"
      lastname:
        type: string
        example: "Cabanilla"

  Patient:
    type: object
    properties:
      id:
        type: string
      personId:
        type: string
      erased:
        type: boolean
        example: false
      notes:
        type: string
        description: "Alguna descripcion que se necesite hacer del paciente, es para uso interno"
        example: "El paciente tiene antecedentes cardiacos"
      socialSecurityId:
        type: string
    
  Login:
    type: object
    properties:
      token:
        type: string
      client:
        type: string

  Error:
    type: object
    properties:
      message:
        type: string